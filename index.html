<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<title>English Premier League</title>
		<link rel="stylesheet" type="text/css" href="style/style.css">
		<script src= 'javascript/script.js' type='text/javascript'></script>
		<script src="d3/d3.js"></script>
		<!--<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>-->
	</head>
<<<<<<< HEAD
	<style>
/*		html { 
		  background: url(football.png) no-repeat center center fixed; 
		  -webkit-background-size: cover;
		  -moz-background-size: cover;
		  -o-background-size: cover;
		  background-size: cover;
		}*/
		
		body {
		  text-align: center;
		  font-family: sans-serif; 
		  font-weight: bold;
		}

		.axis path,
		.axis line {
		  fill: none;
		  stroke: #484848  ;
		  shape-rendering: crispEdges;
		  
		}
		
		
		.dot {
		  stroke: #fff;
		}
		

		.tooltip {
		  position: absolute;
		  width: 200px;
		  height: 28px;
		  pointer-events: none;
		  font-size:1em;
		  color:#484848;
		}

		.brush .extent {
		  stroke: none;
		  fill-opacity: .2;
		  shape-rendering: crispEdges; 
		}
		
		
		</style>
=======
	
>>>>>>> origin/master
	<body>
		<h2 class="titleText">What does it take to win the EPL?</h2>
		<script>
			
			var clSelected = false;
			var holdSelected = false;
			var relegatedSelected = false;
			
			var margin = {top: 150, right: 200, bottom: 30, left: 100},
    			width = 1300 - margin.left - margin.right,
    			height = 720 - margin.top - margin.bottom;
			

			var timeline = {
				g: null,
				height: 80,
				width: width
			};


			// add the graph canvas to the body of the webpage
			var svg = d3.select("body").append("svg")
			    .attr("width", width + margin.left + margin.right)
			    .attr("height", height + margin.top + margin.bottom)
			    .attr("margin","auto")
			  .append("g")
			    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


			timeline.g = svg.append("g")
			    .attr("class", "timeline")
			    .attr("width", timeline.width)
			    .attr("transform", "translate(0," + (height - timeline.height) + ")");

			/* 
			 * value accessor - returns the value to encode for a given data object.
			 * scale - maps value to a visual display encoding, such as a pixel position.
			 * map function - maps from data value to display value
			 * axis - sets up axis
			 */ 
<<<<<<< HEAD
			 
=======
>>>>>>> origin/master

    		//Actual graph
			// setup x 
			var xValue = function(d) { return d.Points;}, // data -> value
			    xScale = d3.scale.linear().range([0, width]), // value -> display
			    xMap = function(d) { return xScale(xValue(d));}, // data -> display
			    xAxis = d3.svg.axis().scale(xScale).orient("bottom");

			// setup y
			var yValue = function(d) { return d["Net Spending"];}, // data -> value
			    yScale = d3.scale.linear().range([height, 0]), // value -> display
			    yMap = function(d) { return yScale(yValue(d));}, // data -> display
			    yAxis = d3.svg.axis().scale(yScale).orient("left");

			var rValue = function(d) { return d["Gross Spending"];},
				rMap = function(d) { 
					if(rValue(d) == 0) return 1;
					else return rValue(d)/2000000;
				};

			// setup fill color
			var cValue = function(d) { 
				return d["Table Standing"];},
				
			    //color = d3.scale.category20();
			    color = d3.scale.ordinal()
<<<<<<< HEAD
			    		.range(["#FFFF66","#CCFFFF  ","#FF9933"])
=======
			    		/*.range(["#00FF00", "#00FF00","#00FF00","#00FF00","#d3d3d3", "#d3d3d3","#d3d3d3","#d3d3d3","#d3d3d3","#d3d3d3","#d3d3d3","#d3d3d3","#d3d3d3","#d3d3d3","#d3d3d3","#d3d3d3","#d3d3d3","#FF0000","#FF0000","#FF0000"])
			    		.domain([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]);*/
			    		.range(["#f0c609","#00184a","#e6002c"/*"#FFFF66","#CCFFFF","#FF9933"*/])
>>>>>>> origin/master
			    		.domain(["Champion's League", "Hold League", "Relegation"]);
		
<<<<<<< HEAD
=======
			//console.log(cValue);
			
			// add the graph canvas to the body of the webpage
			var svg = d3.select("body").append("svg")
			    .attr("width", width + margin.left + margin.right)
			    .attr("height", height + margin.top + margin.bottom)
			  .append("g")
			    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
			    .call(d3.behavior.zoom()/*.x(xScale).y(yScale)*/.scaleExtent([1, 6]).on("zoom", zoom/*ed*/))
			  .append("g")
			    //.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
>>>>>>> origin/master

//-------------------timeline x and y axis setup---------------------------
			var x = d3.time.scale()
			 	.range([0,timeline.width])
			 	.clamp(true);

			var y = d3.scale.linear()
    			.range([timeline.height, 0]);


    		var xAxis2 = d3.svg.axis()
			    .scale(x)
			    .ticks(d3.time.year, 8)
			    .tickSize(10, 1)
			    //.tickFormat(d3.time.format('%y'))
			    .orient("bottom");

			var brush = d3.svg.brush()
				.x(x)
				.on("brush",update)
				.on("brushend",brushedend);


//-----------------------------------------------------------------------
			// add the tooltip area to the webpage
			var tooltip = d3.select("body").append("div")
			    .attr("class", "tooltip")
			    //.style("background-color", #fff)
			    .style("opacity", 0);

			var spending;
			var slider;
			var dots;
			
			// load data
			d3.csv("Stats.csv.csv", function(error, data) {
<<<<<<< HEAD

			  spending = data;
			  // change string (from CSV) into number format
=======
			    //console.log(data);
			    // change string (from CSV) into number format
>>>>>>> origin/master
			  data.forEach(function(d) {
			    d["Net Spending"] = parseInt(d["Net Spending"].replace(/,/g, ''));
			    d.POS = +d.POS;
			    d["Season"] = (d["Season"].split("-",1));
			  });

			  // don't want dots overlapping axis, so add in buffer to data domain
			  xScale.domain([0, d3.max(data, xValue)]);//this apparently fixed the x-axis issue 
			  yScale.domain([d3.min(data, yValue)-1,170000000]);
			  
			
			  // x-axis
			  svg.append("g")
			      .attr("class", "x axis")
				  .style("fill", "#484848 "  )
			      .attr("transform", "translate(0," + height + ")")
			      .call(xAxis)
			    .append("text")
			      .attr("class", "label")
			      .attr("x", width)
			      .attr("y", -6)
			      .style("text-anchor", "end")
			      .text("Points");

			  // y-axis
			  svg.append("g")
			      .attr("class", "y axis")
				  .style("fill", "#484848 "  )
			      .call(yAxis)
			    .append("text")
			      .attr("class", "label")
			      .attr("transform", "rotate(-90)")
			      .attr("y", 6)
			      .attr("dy", ".71em")
			      .style("text-anchor", "end")
			      .text("Net Spending");

			  // draw dots
			  dots = svg.selectAll(".dot")
			      .data(data)
			    .enter().append("circle")
			      .attr("class", "dot")
			      .attr("r", rMap)
			      .attr("transform", function(d) { return "translate(" + d + ")"; })
			      .attr("cx", xMap)
			      .attr("cy", yMap)
			      .style("fill", function(d) {  return color(cValue(d));
				  }) 
			      .on("mouseover", function(d) {
					 d3.select(this).style("opacity", 0.6);
			          tooltip.transition()
			               .duration(200)
			               .style("opacity", 0.9);
			          tooltip.html(d["TEAM"] + "<br/>" + xValue(d) 
				        + " Points<br/>Gross $" + yValue(d) + " ")
			               .style("left", (d3.event.pageX + 5) + "px")
			               .style("top", (d3.event.pageY - 28) + "px");
			      })
			      .on("mouseout", function(d) {
					  d3.select(this).style("opacity", 1);	
			          tooltip.transition()
			               .duration(500)
			               .style("opacity", 0);
			      });
				  
<<<<<<< HEAD

=======
>>>>>>> origin/master
			  // draw legend
			  var legend = svg.selectAll(".legend")
			      .data(color.domain())
			    .enter().append("g")
			      .attr("class", "legend")
			      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

			  // draw legend colored rectangles
			  legend.append("rect")
			      .attr("x", width + 170)
			      .attr("width", 18)
			      .attr("height", 18)
				  .on("mouseover", function(d) {
				      console.log(d);
						if(d == "Champion's League"){
							svg.selectAll(".dot")
							      .transition()
							      .duration(50)
							      .style("opacity", 0.2)
							    //.filter(if(d == "Champion's League"))
							     // .style("opacity", 1);
						} 
						if(d == "Hold League"){
							holdSelected = true;
						}
						if(d == "Relegation"){
							relegatedSelected = true;
						}

					d3.selectAll('.dot').style("opacity",0.6);
			      })
				  .on("mouseout", function(d) {
<<<<<<< HEAD
					  clSelected = false;
					  holdSelected = false;
					  relegatedSelected = false;

					  d3.selectAll('.dot').style("opacity",1);
=======
					  svg.selectAll(".dot").transition()
					      .duration(100)
					      .style("opacity", 1);
>>>>>>> origin/master
			      })
			      .style("fill", color);
					
			  // draw legend text
			  legend.append("text")
			      .attr("x", width + 160)
			      .attr("y", 9)
			      .attr("dy", ".35em")
			      .style("text-anchor", "end")
				  .style("fill", "#484848 "  )
			      .text(function(d) { return d;})
				  
//--------------------- slider ------------------------------
			  var domain = d3.extent(data, function(d) { return d["Season"]; });
			  var offset = d3.time.year.offset;
			  x.domain([offset(domain[0], 31), offset(domain[1], 41)]);
			  y.domain([0, 50]);  

			  // Axis
			  timeline.g.append("g")
			      .attr("class", "x axis")
			      .attr("transform", "translate(0," + timeline.height + ")")
			      .call(xAxis2);

			brush.extent([offset(data[0]["Season"], 31), data[21]["Season"]]);

			  slider = timeline.g.append("g")
			    .attr("class", "brush")
			    .call(brush);

			  slider.selectAll(".resize,.background")
			    .remove();

			  slider.selectAll("rect")
			    .attr("height", timeline.height + 6)
			    .attr("width", 50)
			    .attr("y", -5);

			  slider.append("text")
			    .style("text-anchor", "middle")
			    .attr("y", 10)
			    .attr("x", x(data[0]["Season"]))
			    .style("stroke", "none")
			    .style("fill", "Black")
			    .style("font-weight", "bold")
			    .style("font-size", "15px")
			    .text(data[0]["Season"]);

			});	
		

<<<<<<< HEAD
		function brushedend() {
		  var extent0 = brush.extent(),extent1;

		  var d0 = d3.time.year.floor(extent0[0]);
		  d0 = d3.time.year.offset(d0, 1);
		  var d1 = d3.time.year.offset(d0, 1);
		  extent1 = [d0, d1];

		  d3.select(this).call(brush.extent(extent1));

		  update();
		}
		

		function update() {

		  var index = (((brush.extent()[0]).getFullYear()) - 2001)*20;
		  console.log(brush.extent()[0].getFullYear());
		  console.log(index);

		  var sel=" ";
		  console.log(spending[index]);

		  var i;

//		  for (i = index; i < index+20; i++) 
//		  { 
		    sel = spending[index];
		    dots.data(sel);
		    dots.attr("visibility","visible");

		    console.log(sel);
		  //}

		  console.log(brush.extent()[0].getFullYear());
		 
		  
		  var tx = x(d3.time.year.offset(brush.extent()[0], 1))
		  slider.select("text").text(brush.extent()[0].getFullYear()).attr("x", tx);

		  

		  //   arcs.select("text")
		  //     .attr("transform", function(d) { return "translate(" + arc.centroid(d) + ")"; })
		  //     .text(function(d) { return d.value; });

		  // games.text(sel.games);
		  // count.data([sel.gold, sel.silver, sel.bronze])
		  //   .select("text")
		  //   .text(function(d) { return d; });
		  // comments.text(sel.comments);
		}
						
=======
			function zoom() {
				svg.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
				/*svg.select(".xScale.axis").call(xAxis);
				svg.select(".yScale.axis").call(yAxis);*/
			}
>>>>>>> origin/master
		</script>

		<p class="questions">Does spending more money mean a club wins more Championships? 
		</br>How many points does a club need on average to make it into the Champions League? 
		</br>How much money does it take to stay a top-flight club?</p>

	</body>
</html>